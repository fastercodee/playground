<script type="modulE" id="s-preview">
  import { listen, put } from "http://esm.run/@fcanvas/communicate"
console.log("init ted")

addEventListener("message", (event) => {
  const { port2 } = event.data

  port2.start()

console.log("port: ", port2)


put(port2, "get file", {
  url: location.href,
  headers: []
})

  const js = document.querySelector("#s-preview").outerHTML

      const cast = new BroadcastChannel("sw-fetch")
      window.cast = cast

      const encoder = new TextEncoder()

      listen(cast, "get file", async (opts) => {
        const url = new URL(opts.url)

put(port2, "get file", opts)

        let content = "hello world"

        return {
          transfer: [encoder.encode(content)],
          return: {
            content: encoder.encode(content),
            init: {
              status: 200,
            },
          },
        }
      })
  // eslint-disable-next-line promise/catch-or-return
  navigator.serviceWorker
    .register("/sw.js")
    // eslint-disable-next-line promise/always-return
    .then(() => {
    })
})
</script>
